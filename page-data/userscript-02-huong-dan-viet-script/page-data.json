{"componentChunkName":"component---src-templates-blog-post-js","path":"/userscript-02-huong-dan-viet-script","result":{"data":{"content":{"edges":[{"node":{"id":"Article_5e958a19a472c64228292c21","title":"UserScripts [02] Hướng Dẫn Viết Script Getlink Nhaccuatui","description":"Bài viết này được viết khi mình đang thêm 1 cái music player cho blog thì down thử 1 bài hát từ nhaccuatui và không được nên làm cái script giúp các bạn có thể dễ dàng download bài hát từ site này về ^^!.Lưu ý là cách này chỉ có nhạc 128 thôi nên chắc nhaccuatui còn lâu mới fix","slug":"userscript-02-huong-dan-viet-script","content":"# **UserScripts [02] Hướng Dẫn Viết Script Getlink Nhaccuatui**\nBài viết này được viết khi mình đang thêm 1 cái music player cho blog thì down thử 1 bài hát từ nhaccuatui và không được nên làm cái script giúp các bạn có thể dễ dàng download bài hát từ site này về ^^!.Lưu ý là cách này chỉ có nhạc 128 thôi nên chắc nhaccuatui còn lâu mới fix :v\nBắt đầu nào:\n- Autoplay chuyển bài rồi thôi để play bài Yêu Five (Yêu 5) Lâu rồi chưa nghe.\n    Link Cho AE https://www.nhaccuatui.com/bai-hat/yeu-5-rhymastic.KBov6SjzSzzj.html\n\n- Khởi đầu thì mình view-source của nhaccuatui và thấy rằng tại vị trí khởi tạo player của nhaccuatui có vài cái link và mình đã mò thấy cái link dạng XML thế này:https://www.nhaccuatui.com/flash/xml?html5=true&key1=ef30711e703a77c19177b51a3ed66da8\nKhi Vào link này bạn sẽ thấy ....\n\n![xml_url](/assets/contents/userscript/1.png)\n\nà ko thấy gì cả ngoài chữ \"song\" có gì đó kì kì tại sao lại config player với chữ này thử view-source tiếp file này nào\n\n![xml_content](/assets/contents/userscript/2.png)\n\nA đây rồi bạn có thấy gì không chính là thông tin của bài hát bạn đang tìm đó\nỞ Tag Location là link mp3,Tag Creator là tác giả,Title là tên bài hát,...\n-Tiếp theo là code thôi\nĐể lấy dc cái link XML Kia thì mình nghĩ Regular Expression (RegEx) là cách nhanh gọn lẹ nhất :3\nMình Chọn Công Cụ Debug Là https://regex101.com/\nSau 1 hồi quằng quại thì mình ra được cái kết quả là chuỗi này:\n``` javascript\n/https:\\/\\/www.nhaccuatui.com\\/flash\\/xml\\?html5=true&key1=[a-z,0-9]{30,35}/gm\n```\n![regex_pattern](/assets/contents/userscript/3.png)\n\nKế đến mình viết 1 đoạn script để lấy thử cái link XML từ trang nhaccuatui\n\n``` javascript\nvar domDocument = document.documentElement.innerHTML;\nvar link = /https:\\/\\/www.nhaccuatui.com\\/flash\\/xml\\?html5=true&key1=[a-z,0-9]{30,35}/.exec(domDocument);\nalert(link)\n```\n\nÀ quên tại sao là alert() mà không phải console.log() thì nhaccuatui đã chặn bạn xuất kết quả trong console\nTiếp theo là test coi link lấy được có trả về giá trị mong muốn hay không\n\n``` javascript\nvar x = new XMLHttpRequest();\nx.open(\"GET\", link, true);\nx.onreadystatechange = function () {\n  alert(x.responseText);\n};\nx.send(null);\n```\nSau khi đã lấy được điều mong muốn thì mình tiếp tục parse cái Text thành XML (responseXML Không Được nên mình mới parse nha) bằng đoạn code bên dưới\n``` javascript\nparser = new DOMParser();\nxmlDoc = parser.parseFromString(text,\"text/xml\");\n```\nVà sau khi parse xong thì mình đến bước cuối lấy tag Location ra và mở tab mới với đoạn Code trên là xong ^^'\n``` javascript\nxmlDoc.getElementsByTagName(\"location\")[0].childNodes[0].nodeValue;\n```\nToàn Bộ Đoạn Code \n\n``` javascript\nvar domDocument = document.documentElement.innerHTML;\nvar link = /https:\\/\\/www.nhaccuatui.com\\/flash\\/xml\\?html5=true&key1=[a-z,0-9]{30,35}/.exec(domDocument);\nvar x = new XMLHttpRequest();\nx.open(\"GET\", link, true);\nx.onreadystatechange = function () {\n  parser = new DOMParser();\n  xmlDoc = parser.parseFromString(x.responseText,\"text/xml\");\n  mp3Link = xmlDoc.getElementsByTagName(\"location\");\n};\nx.send(null);\nwindow.open(mp3Link[0].textContent);\n```\n\nCode Sau Khi Được Làm Đẹp Thêm Tí Cho Thêm Cái Notification\n\n``` javascript\njavascript: (function() {var _0xd73f=[\"\\x35\\x20\\x74\\x3D\\x48\\x2E\\x77\\x2E\\x42\\x3B\\x35\\x20\\x6F\\x3D\\x2F\\x66\\x3A\\x5C\\x2F\\x5C\\x2F\\x47\\x2E\\x49\\x2E\\x6D\\x5C\\x2F\\x50\\x5C\\x2F\\x6A\\x5C\\x3F\\x51\\x3D\\x67\\x26\\x52\\x3D\\x5B\\x61\\x2D\\x7A\\x2C\\x30\\x2D\\x39\\x5D\\x7B\\x53\\x2C\\x4E\\x7D\\x2F\\x2E\\x4C\\x28\\x74\\x29\\x3B\\x35\\x20\\x78\\x3D\\x62\\x20\\x4D\\x28\\x29\\x3B\\x78\\x2E\\x70\\x28\\x22\\x54\\x22\\x2C\\x6F\\x2C\\x67\\x29\\x3B\\x78\\x2E\\x4B\\x3D\\x37\\x28\\x29\\x7B\\x68\\x3D\\x62\\x20\\x4A\\x28\\x29\\x3B\\x63\\x3D\\x68\\x2E\\x4F\\x28\\x78\\x2E\\x41\\x2C\\x22\\x79\\x2F\\x6A\\x22\\x29\\x3B\\x69\\x3D\\x63\\x2E\\x6E\\x28\\x22\\x44\\x22\\x29\\x3B\\x65\\x3D\\x63\\x2E\\x6E\\x28\\x22\\x65\\x22\\x29\\x7D\\x3B\\x78\\x2E\\x46\\x28\\x45\\x29\\x3B\\x31\\x3D\\x69\\x5B\\x30\\x5D\\x2E\\x72\\x3B\\x36\\x28\\x21\\x28\\x22\\x32\\x22\\x56\\x20\\x71\\x29\\x29\\x7B\\x31\\x39\\x28\\x22\\x31\\x68\\x20\\x31\\x38\\x20\\x31\\x37\\x20\\x31\\x63\\x20\\x31\\x67\\x20\\x55\\x20\\x38\\x22\\x29\\x7D\\x6C\\x20\\x36\\x28\\x32\\x2E\\x33\\x3D\\x3D\\x3D\\x22\\x6B\\x22\\x29\\x7B\\x64\\x28\\x31\\x29\\x7D\\x6C\\x20\\x36\\x28\\x32\\x2E\\x33\\x21\\x3D\\x3D\\x27\\x31\\x66\\x27\\x29\\x7B\\x32\\x2E\\x31\\x65\\x28\\x37\\x28\\x33\\x29\\x7B\\x36\\x28\\x33\\x3D\\x3D\\x3D\\x22\\x6B\\x22\\x29\\x7B\\x64\\x28\\x31\\x29\\x7D\\x7D\\x29\\x7D\\x37\\x20\\x64\\x28\\x31\\x29\\x7B\\x35\\x20\\x38\\x3D\\x62\\x20\\x32\\x28\\x27\\x31\\x64\\x20\\x31\\x62\\x20\\x31\\x36\\x27\\x2C\\x7B\\x59\\x3A\\x27\\x66\\x3A\\x2F\\x2F\\x58\\x2E\\x57\\x2E\\x6D\\x2F\\x75\\x2F\\x5A\\x3F\\x73\\x3D\\x31\\x30\\x26\\x76\\x3D\\x34\\x27\\x2C\\x31\\x35\\x3A\\x22\\u0110\\xE3\\x20\\x31\\x31\\x20\\x31\\x32\\xE0\\x31\\x33\\x20\\x43\\xF4\\x31\\x34\\x22\\x2B\\x65\\x5B\\x30\\x5D\\x2E\\x72\\x2C\\x7D\\x29\\x3B\\x38\\x2E\\x31\\x61\\x3D\\x37\\x28\\x29\\x7B\\x71\\x2E\\x70\\x28\\x31\\x29\\x7D\\x7D\",\"\\x7C\",\"\\x73\\x70\\x6C\\x69\\x74\",\"\\x7C\\x63\\x6F\\x6E\\x74\\x65\\x6E\\x74\\x7C\\x4E\\x6F\\x74\\x69\\x66\\x69\\x63\\x61\\x74\\x69\\x6F\\x6E\\x7C\\x70\\x65\\x72\\x6D\\x69\\x73\\x73\\x69\\x6F\\x6E\\x7C\\x7C\\x76\\x61\\x72\\x7C\\x69\\x66\\x7C\\x66\\x75\\x6E\\x63\\x74\\x69\\x6F\\x6E\\x7C\\x6E\\x6F\\x74\\x69\\x66\\x69\\x63\\x61\\x74\\x69\\x6F\\x6E\\x7C\\x7C\\x7C\\x6E\\x65\\x77\\x7C\\x78\\x6D\\x6C\\x44\\x6F\\x63\\x7C\\x73\\x65\\x6E\\x64\\x4E\\x6F\\x74\\x69\\x7C\\x74\\x69\\x74\\x6C\\x65\\x7C\\x68\\x74\\x74\\x70\\x73\\x7C\\x74\\x72\\x75\\x65\\x7C\\x70\\x61\\x72\\x73\\x65\\x72\\x7C\\x6D\\x70\\x33\\x4C\\x69\\x6E\\x6B\\x7C\\x78\\x6D\\x6C\\x7C\\x67\\x72\\x61\\x6E\\x74\\x65\\x64\\x7C\\x65\\x6C\\x73\\x65\\x7C\\x63\\x6F\\x6D\\x7C\\x67\\x65\\x74\\x45\\x6C\\x65\\x6D\\x65\\x6E\\x74\\x73\\x42\\x79\\x54\\x61\\x67\\x4E\\x61\\x6D\\x65\\x7C\\x6C\\x69\\x6E\\x6B\\x7C\\x6F\\x70\\x65\\x6E\\x7C\\x77\\x69\\x6E\\x64\\x6F\\x77\\x7C\\x74\\x65\\x78\\x74\\x43\\x6F\\x6E\\x74\\x65\\x6E\\x74\\x7C\\x7C\\x64\\x6F\\x6D\\x44\\x6F\\x63\\x75\\x6D\\x65\\x6E\\x74\\x7C\\x7C\\x7C\\x64\\x6F\\x63\\x75\\x6D\\x65\\x6E\\x74\\x45\\x6C\\x65\\x6D\\x65\\x6E\\x74\\x7C\\x7C\\x74\\x65\\x78\\x74\\x7C\\x7C\\x72\\x65\\x73\\x70\\x6F\\x6E\\x73\\x65\\x54\\x65\\x78\\x74\\x7C\\x69\\x6E\\x6E\\x65\\x72\\x48\\x54\\x4D\\x4C\\x7C\\x7C\\x6C\\x6F\\x63\\x61\\x74\\x69\\x6F\\x6E\\x7C\\x6E\\x75\\x6C\\x6C\\x7C\\x73\\x65\\x6E\\x64\\x7C\\x77\\x77\\x77\\x7C\\x64\\x6F\\x63\\x75\\x6D\\x65\\x6E\\x74\\x7C\\x6E\\x68\\x61\\x63\\x63\\x75\\x61\\x74\\x75\\x69\\x7C\\x44\\x4F\\x4D\\x50\\x61\\x72\\x73\\x65\\x72\\x7C\\x6F\\x6E\\x72\\x65\\x61\\x64\\x79\\x73\\x74\\x61\\x74\\x65\\x63\\x68\\x61\\x6E\\x67\\x65\\x7C\\x65\\x78\\x65\\x63\\x7C\\x58\\x4D\\x4C\\x48\\x74\\x74\\x70\\x52\\x65\\x71\\x75\\x65\\x73\\x74\\x7C\\x33\\x35\\x7C\\x70\\x61\\x72\\x73\\x65\\x46\\x72\\x6F\\x6D\\x53\\x74\\x72\\x69\\x6E\\x67\\x7C\\x66\\x6C\\x61\\x73\\x68\\x7C\\x68\\x74\\x6D\\x6C\\x35\\x7C\\x6B\\x65\\x79\\x31\\x7C\\x33\\x30\\x7C\\x47\\x45\\x54\\x7C\\x64\\x65\\x73\\x6B\\x74\\x6F\\x70\\x7C\\x69\\x6E\\x7C\\x67\\x69\\x74\\x68\\x75\\x62\\x75\\x73\\x65\\x72\\x63\\x6F\\x6E\\x74\\x65\\x6E\\x74\\x7C\\x61\\x76\\x61\\x74\\x61\\x72\\x73\\x31\\x7C\\x69\\x63\\x6F\\x6E\\x7C\\x31\\x37\\x35\\x32\\x33\\x35\\x36\\x37\\x7C\\x34\\x36\\x30\\x7C\\x47\\x65\\x74\\x7C\\x54\\x68\\x7C\\x6E\\x68\\x7C\\x6E\\x67\\x7C\\x62\\x6F\\x64\\x79\\x7C\\x4E\\x68\\x61\\x63\\x63\\x75\\x61\\x74\\x75\\x69\\x7C\\x64\\x6F\\x65\\x73\\x7C\\x62\\x72\\x6F\\x77\\x73\\x65\\x72\\x7C\\x61\\x6C\\x65\\x72\\x74\\x7C\\x6F\\x6E\\x63\\x6C\\x69\\x63\\x6B\\x7C\\x4D\\x50\\x33\\x7C\\x6E\\x6F\\x74\\x7C\\x47\\x65\\x74\\x4C\\x69\\x6E\\x6B\\x7C\\x72\\x65\\x71\\x75\\x65\\x73\\x74\\x50\\x65\\x72\\x6D\\x69\\x73\\x73\\x69\\x6F\\x6E\\x7C\\x64\\x65\\x6E\\x69\\x65\\x64\\x7C\\x73\\x75\\x70\\x70\\x6F\\x72\\x74\\x7C\\x54\\x68\\x69\\x73\",\"\",\"\\x66\\x72\\x6F\\x6D\\x43\\x68\\x61\\x72\\x43\\x6F\\x64\\x65\",\"\\x72\\x65\\x70\\x6C\\x61\\x63\\x65\",\"\\x5C\\x77\\x2B\",\"\\x5C\\x62\",\"\\x67\"];eval(function(_0x2664x1,_0x2664x2,_0x2664x3,_0x2664x4,_0x2664x5,_0x2664x6){_0x2664x5= function(_0x2664x3){return (_0x2664x3< _0x2664x2?_0xd73f[4]:_0x2664x5(parseInt(_0x2664x3/ _0x2664x2)))+ ((_0x2664x3= _0x2664x3% _0x2664x2)> 35?String[_0xd73f[5]](_0x2664x3+ 29):_0x2664x3.toString(36))};if(!_0xd73f[4][_0xd73f[6]](/^/,String)){while(_0x2664x3--){_0x2664x6[_0x2664x5(_0x2664x3)]= _0x2664x4[_0x2664x3]|| _0x2664x5(_0x2664x3)};_0x2664x4= [function(_0x2664x5){return _0x2664x6[_0x2664x5]}];_0x2664x5= function(){return _0xd73f[7]};_0x2664x3= 1};while(_0x2664x3--){if(_0x2664x4[_0x2664x3]){_0x2664x1= _0x2664x1[_0xd73f[6]]( new RegExp(_0xd73f[8]+ _0x2664x5(_0x2664x3)+ _0xd73f[8],_0xd73f[9]),_0x2664x4[_0x2664x3])}};return _0x2664x1}(_0xd73f[0],62,80,_0xd73f[3][_0xd73f[2]](_0xd73f[1]),0,{}))})()\n```\nSau khi đã hoàn thành mình lưu vào bookmark mỗi lần dùng thì chỉ cần ấn là xong\n","date":"2018-06-01","headerImage":{"publicURL":"/static/e258f9d8b3ea975eafef9b80a5075fa9/dc3c1fb48f99cdb8ff4221300d91d292.png"}},"previous":null,"next":null}]}},"pageContext":{"id":"Article_5e958a19a472c64228292c21","index":6}}}