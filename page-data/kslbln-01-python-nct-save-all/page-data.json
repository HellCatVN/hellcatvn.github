{"componentChunkName":"component---src-templates-blog-post-js","path":"/kslbln-01-python-nct-save-all","result":{"data":{"content":{"edges":[{"node":{"id":"Article_5e95c1bfa472c64228292c2a","title":"KSLBLN [01]  Script Python Tải Tất Cả Thông Tin Bài Hát Nhạc Của Tui","description":"Có lẽ bạn thắc mắc series này mang tên [KSLBLN] có nghĩ là gì thì mình xin được giải đáp thêm đó chính là khi sự lười biến lên ngôi\nTrong series hôm nay thì mình xin Được viết về Nhaccuatui....Vâng chính là nó sau khi làm cái <a href=\"../userscript-02-huong-dan-viet-script/\">UserScript Get Nhaccuatui</a> ,kiếm xong cái player phát nhạc thì phát hiện cái player nó hỗ trợ cả lyric lẫn thumbnail....Nên mình quyết định làm 1 script tự động tải file MP3,Lyric,Thumbnail Theo List Link Nhạc Của Mình Tạo Sẵn","slug":"kslbln-01-python-nct-save-all","content":"Có lẽ bạn thắc mắc series này mang tên [KSLBLN] có nghĩ là gì thì mình xin được giải đáp thêm đó chính là khi sự lười biến lên ngôi\nTrong series hôm nay thì mình xin Được viết về Nhaccuatui....Vâng chính là nó sau khi làm cái <a href=\"../userscript-02-huong-dan-viet-script/\">UserScript Get Nhaccuatui</a> ,kiếm xong cái player phát nhạc thì phát hiện cái player nó hỗ trợ cả lyric lẫn thumbnail....Nên mình quyết định làm 1 script tự động tải file MP3,Lyric,Thumbnail Theo List Link Nhạc Của Mình Tạo Sẵn\n\nĐầu tiên thì vẫn là xuất phát từ file xml mà mình đã nhắc đến ở bài <a href=\"../userscript-02-huong-dan-viet-script/\">Hướng Dẫn Viết UserScript Get Nhaccuatui</a>\nMình sẽ bắt đầu từ đoạn tải và giải mã khi đã lấy dc các link từ file xml\nCơ bản để đọc được file xml thì mình dùng thư viện xmltodict ở dòng 34 và import nó vào ở dòng 5 vậy nên anh em dùng pip cài dùm mình các gói đã import để chạy à còn nữa :v script này chạy trên python 2 và chạy trên linux nha nếu bạn không muốn chạy trên linux thì có thể thay wget thành urllib2.urlopen làm như cách mình lưu ảnh thumbnail để get lyric là dc .\nTrở lại vấn đề chính có 1 phần nan giải trong đoạn script trên chính là phần lyric đã được nhaccuatui mã hóa và không thể lấy theo cách bình thường...sau khi tìm hiểu 1 tí thì có cái clip làm thủ công thì mình đã tìm cách viết script python để giải mã đoạn lyric.Cũng không có gì khó khăn đoạn script kia mã hóa hex rồi tới rc4crypt + key => key là Lyr1cjust4nct sau khi tất cả đã xong thì bạn chỉ cần chạy script trên.Những url lưu trong file json listnhac.json\n\nMọi câu hỏi thắc mắc các bạn có thể để lại bình luận phía bên dưới để được giải đáp (Nếu nhiều bạn không chạy được thì mình sẽ làm video clip hướng dẫn).\n\nUpdate 20/6/2018\n\nĐây là bản code dành cho windows Kéo xuống cuối bài nhaaaa <3.\n\n```bash\npython +tenfile.py\n```\n\n```json\n[\n    {\n        \"url\" : \"https://www.nhaccuatui.com/bai-hat/be-your-everything-boys-like-girls.svT3AyrSuwDu.html\"\n    },\n    {\n        \"url\" : \"https://www.nhaccuatui.com/bai-hat/yeu-5-hoaprox-remix-rhymastic-ft-hoaprox.M3U0CaCWI4ig.html\"\n    }\n]\n```\nScript Lấy Nhạc\n\n```python\nimport re\nimport requests\nimport urllib2\nimport json\nimport xmltodict\nimport os\n\n\ndef rc4crypt(data, key):\n    x = 0\n    box = range(256)\n    for i in range(256):\n        x = (x + box[i] + ord(key[i % len(key)])) % 256\n        box[i], box[x] = box[x], box[i]\n    x = 0\n    y = 0\n    out = []\n    for char in data:\n        x = (x + 1) % 256\n        y = (y + box[x]) % 256\n        box[x], box[y] = box[y], box[x]\n        out.append(chr(ord(char) ^ box[(box[x] + box[y]) % 256]))\n\n    return ''.join(out)\n\ndef createJson(url):\n    response = urllib2.urlopen(url)\n    pagecontent=response.read().decode('utf-8')\n    pattern = 'https:\\/\\/www.nhaccuatui.com\\/flash\\/xml\\?html5=true&key1=[a-z,0-9]{30,35}'\n    result = re.findall(pattern, pagecontent)\n    response = urllib2.urlopen(result[0])\n    pagecontent=response.read().decode('utf-8')\n\n    data = xmltodict.parse(pagecontent)\n\n    tracklistInside = data['tracklist']['track']\n\n    songLink = data['tracklist']['track']['location']\n    lyricLink = data['tracklist']['track']['lyric']\n    picLink = data['tracklist']['track']['avatar']\n\n    print (lyricLink)\n\n    #save MP3 File\n    response = urllib2.urlopen(songLink)\n    fileMp3 = response.read()\n    f = open('mp3/'+data['tracklist']['track']['title'], 'wb')\n    f.write(fileMp3)\n    f.close()\n\n    #save pic File\n    response = urllib2.urlopen(picLink)\n    filePic = response.read()\n    f = open('pic/'+data['tracklist']['track']['title'], 'wb')\n    f.write(filePic)\n    f.close()\n\n    if lyricLink is not None:\n        os.system('wget ' + lyricLink + ' -O lyric/encrypted')\n        \n        lyricencrypted = open('lyric/encrypted').readline()\n\n        lyricdecrypted = rc4crypt(lyricencrypted.decode('hex'), 'Lyr1cjust4nct')\n\n        f = open('lyric/'+data['tracklist']['track']['title'], 'wb')\n        f.write(lyricdecrypted)\n        f.close()\n    \n    jsondata = json.load(open('music.json'))\n\n    res = {}\n\n    res['title'] =  data['tracklist']['track']['title']\n    res['author'] =  data['tracklist']['track']['creator']\n    res['url'] =  \"../mp3/\"+data['tracklist']['track']['title']\n    res['pic'] =  \"../pic/\"+data['tracklist']['track']['title']\n\n    if lyricLink is not None:\n        res['lrc'] =  \"../lyric/\"+data['tracklist']['track']['title']\n    \n    jsondata.append(res)\n\n    with open('music.json', 'w') as outfile:\n        json.dump(jsondata, outfile)\n\ndata = json.load(open('listnhac.json'))\n\nfor val in data:\n    createJson(val['url'])\n```\n\nCode Dành Cho Bản Win\n\n```python\nimport re\nimport requests\nimport urllib2\nimport json\nimport xmltodict\nimport os\n\n\ndef rc4crypt(data, key):\n    x = 0\n    box = range(256)\n    for i in range(256):\n        x = (x + box[i] + ord(key[i % len(key)])) % 256\n        box[i], box[x] = box[x], box[i]\n    x = 0\n    y = 0\n    out = []\n    for char in data:\n        x = (x + 1) % 256\n        y = (y + box[x]) % 256\n        box[x], box[y] = box[y], box[x]\n        out.append(chr(ord(char) ^ box[(box[x] + box[y]) % 256]))\n\n    return ''.join(out)\n\ndef createJson(url):\n    response = urllib2.urlopen(url)\n    pagecontent=response.read().decode('utf-8')\n    pattern = 'https:\\/\\/www.nhaccuatui.com\\/flash\\/xml\\?html5=true&key1=[a-z,0-9]{30,35}'\n    result = re.findall(pattern, pagecontent)\n    response = urllib2.urlopen(result[0])\n    pagecontent=response.read().decode('utf-8')\n\n    data = xmltodict.parse(pagecontent)\n\n    tracklistInside = data['tracklist']['track']\n\n    songLink = data['tracklist']['track']['location']\n    lyricLink = data['tracklist']['track']['lyric']\n    picLink = data['tracklist']['track']['avatar']\n\n    print (lyricLink)\n\n    #save MP3 File\n    response = urllib2.urlopen(songLink)\n    fileMp3 = response.read()\n    f = open('mp3/'+data['tracklist']['track']['title'], 'wb')\n    f.write(fileMp3)\n    f.close()\n\n    #save pic File\n    response = urllib2.urlopen(picLink)\n    filePic = response.read()\n    f = open('pic/'+data['tracklist']['track']['title'], 'wb')\n    f.write(filePic)\n    f.close()\n\n    #Save and Decrypt Lyric\n\n    if lyricLink is not None:\n\n        response = urllib2.urlopen(lyricLink)\n        filelyric = response.read()\n        f = open('lyric/encrypted', 'wb')\n        f.write(filelyric)\n        f.close()    \n\n        lyricencrypted = open('lyric/encrypted').readline()\n\n        lyricdecrypted = rc4crypt(lyricencrypted.decode('hex'), 'Lyr1cjust4nct')\n\n        f = open('lyric/'+data['tracklist']['track']['title'], 'wb')\n        f.write(lyricdecrypted)\n        f.close()   \n\n    jsondata = json.load(open('music.json'))\n\n    res = {}\n\n    res['title'] =  data['tracklist']['track']['title']\n    res['author'] =  data['tracklist']['track']['creator']\n    res['url'] =  \"../mp3/\"+data['tracklist']['track']['title']\n    res['pic'] =  \"../pic/\"+data['tracklist']['track']['title']\n\n    if lyricLink is not None:\n        res['lrc'] =  \"../lyric/\"+data['tracklist']['track']['title']\n    \n\n    jsondata.append(res)\n\n    with open('music.json', 'w') as outfile:\n        json.dump(jsondata, outfile)\n\ndata = json.load(open('listnhac.json'))\n\nfor val in data:\n    createJson(val['url'])\n```","date":"2018-06-15","headerImage":{"publicURL":"/static/275bb81994f7932887b79b8fb2fb69e1/bac1d507443f9c772c9b83c456cf75d5.png"}},"previous":null,"next":null}]}},"pageContext":{"id":"Article_5e95c1bfa472c64228292c2a","index":3}}}